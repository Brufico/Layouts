---
title: "Cross refs, captions + figures with Latex/Pdf documents"
author: "Bruno Fischer Colonimos"
date: "11 juillet 2017"
include_graphics: yes
linkcolor: red
lof: yes
lot: yes
include-before: "\\newcommand*{\\secref}[1]{Section~\\ref{#1}}"
output: 
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
    toc: yes
---


****************
 \ 
 \ 
 
```{r prelim, echo = FALSE}
# getcontext returns the doc conversion context
# From Hadley's ggplot2 book:  Knowing conversion target 
is_latex <- function() {
        identical(knitr::opts_knit$get("rmarkdown.pandoc.to"), "latex")
}

# html same
is_html <- function() {
        identical(knitr::opts_knit$get("rmarkdown.pandoc.to"), "html")
}

getcontext <- function(){
        if (is_latex()) {"latex" 
                   } else if (is_html()) {
                           "html"
                   } else {"other"} 
}

centertext <- function(string, bold = FALSE, context = getcontext()){
        switch(context,
               html = paste0("",string, ""),
               latex = paste0("\\begin{center}", 
                              ifelse(bold, paste0("\\textbf{", string, "}") ,
                                     string),
                              "\\end{center}"),
               other = string) 
}

pagebreak <- function(string = "", active = FALSE, context = getcontext()){
        if (active) {
                switch(context,
                       html = paste0("",string, ""),
                       latex = paste0("\\clearpage", string),
                       other = string)         
        } else {""}
}        


```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 3, fig.height=2, fig.align = "center", fig.show = "hold")
```


```{r libs}
library(ggplot2)
library(knitr)
library(pander)
library(xtable)
```


# Objective {#obj}

Find hard-coded ways to cross-refs. 
Here all is in Latex


# Conclusions {#conclusions}

* figures
    * do not need a "Label" in their captions, 
    * are crossreferencable, as soon as they have a caption option in the chunk.
    (i.e. fig.cap = "some text" creates the reference. The anchor name is the chunk name)
    * What if they are supplied a different name ??
    
* tables
    * Also work without explicit label (at least for kable and pander table), but only the system knows their anchor, so ;
    * do need a label command in their captions
    * If a table is create without a caption, the table index is still incremented: if captions are enabled, it is better to systematically caption all tables. 


* Arbitrary anchors in text:
    * When in a section, a `\label(id)` will point to a section header. But no link is provided to the `\ref(id)`; unless we have `number-sections: yes` in the yaml header 

* Section references
    * see section \secref{sec:mean-diff}


# Including / referencing  Plots and table examples {"plottables"}

You can embed and reference plots. 


## Referencing elements produced later in the document {#refbefore}

Let us reference them before we create them: for example:

* We first have 
    * an uncaptioned kable table in chunk firsttbchunk: table \ref{tab:firsttbchunk}, or maybe \ref{tab:hehe}
    * an uncaptioned pander table in chunk firsttb2chunk: table \ref{tab:firsttb2chunk}    
    * an uncaptioned plot figure \ref{fig:firstchunk}, (chunk name as anchor)

    * a text-captioned (without label) plot figure \ref{fig:secchunk}, (chunk name as anchor), and 
    * a text-captioned plot from an unnamed chunk : \ref{fig:unnamed-chunk-1} (chunk name as anchor)

* Regular captioned figures:
    * Figure \ref{fig:pressure} (using chunk name as anchor)
    * Figure \ref{fig:foo} or 
    * figure \ref{fig:fee}  and at last 
    * figure \ref{fig:faa}

* Referencing the tables : 
    * Table \ref{tab:firsttbchunk},
    * Table \ref{tab:firsttb2chunk},
    * table \ref{tab:mtcars}, 
    * table \ref{tab:cars}

* referencing arbitrary text
    * header link: [more tables section](#sec:moretab) \pageref{#moretab}
    * header ref : \secref(sec:moretab)
    * text \ref{text:verse} link that takes the form of the section number
    * try also the link form: [#sec:moretab]


## Creating Plots and tables {#create}

\label{text:verse}

|       Precise and Visual 
|       ------------------:
|          The plot reigns supreme
|            In the ocean of stats
|  and brings secrets to the light
| hidden treasures, drowned jewels
|
|       But the table that exposes
|              facts to the reader
|    brings numbers in the picture
|             shows proof forcibly
|                  without a doubt



### Two tables and more plots {#twotab}

```{r firsttbchunk}
data("ToothGrowth")
kable(head(ToothGrowth), caption = "hehe")
```

```{r firsttb2chunk}
pander(head(faithful), caption = "hoho")
```

```{r firstchunk}
ggplot(ToothGrowth, aes(dose,len, color=supp))+ geom_jitter()
```


```{r secchunk, fig.cap="text capped figure from secchunk"}
ggplot(ToothGrowth, aes(dose,len, color = supp))+ geom_jitter() + facet_grid(. ~ supp)
```


```{r , fig.cap="text capped figure from unknown"}
ggplot(ToothGrowth, aes(dose,len, color = supp))+ geom_jitter() + facet_grid(supp ~ .)
```



```{r pressure, echo=FALSE, fig.cap = "hard-coded"}
# removed:"\\label{fig:foo}This is caption fig 0"
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r foo, fig.cap = "caption fig 1"}
ggplot(mtcars, aes(wt, mpg))+ geom_point()
```


```{r fee, fig.cap = "\\label{fig:fee}This is caption fig 2" }
ggplot(mtcars, aes(cyl, mpg))+ geom_boxplot(aes(group=cyl))
```

Some more text to separate items the, a ast plot

```{r chunfkfaa, fig.cap = "\\label{fig:faa}This is caption fig 3"}
ggplot(mtcars, aes(disp, mpg))+ geom_point(aes(color=factor(cyl)))

```

### More Tables {#sec:moretab}

You can have tables like this:

```{r mtcars}
kable(head(mtcars[, 1:5]), 
      caption = "\\label{tab:mtcars}This is the 'mtcars' `kable` table (ie 1)")
      
```


Or another: 

```{r cars}
kable(summary(cars), 
      caption = "\\label{tab:cars}This is the 'cars' `kable` table (ie 2)")
```

`r pagebreak() `

And another

```{r xcars, results='asis'}
kable(list(summary(cars),summary(ToothGrowth)), 
      caption = "\\label{tab:xcars}This is the 'cars' `kable` double table (ie 3)")
```



## Referencing again after the creation: {#refagain}

`r pagebreak()`

And you can also reference figures again:  

* we first have 
    * an uncaptioned plot figure \ref{fig:firstchunk}, 
    * and an uncapped table in the same  chunk: table \ref{tab:firsttbchunk}
    * a text-captioned (without label) plot figure \ref{fig:secchunk}, (chunk name as anchor), and 
    * a text-captioned plot from an unnamed chunk : \ref{fig:unnamed-chunk-1} (chunk name as anchor)

* Regular captioned figures:
    * Figure \ref{fig:pressure} (using chunk name as anchor)
    * Figure \ref{fig:foo} or 
    * figure \ref{fig:fee}  and at last 
    * figure \ref{fig:faa}


* Referencing the tables : 
    * Table \ref{tab:firsttbchunk}, 
    * table \ref{tab:mtcars}, 
    * table \ref{tab:cars}
    * table \ref{tab:xcars}


# The end {#end}

And some text to finish: \
`r centertext( "Goodbye", bold = TRUE)`


